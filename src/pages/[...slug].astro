---
import { App, getRoutes } from "../app";
import { getCollection } from "astro:content";
import type { Navigation } from "../app/docs";
import "@fontsource-variable/raleway";

async function generateNavigation() {
	const docs = await getCollection("docs");
	const result: Record<string, Navigation[number]> = {};
	for (const doc of docs) {
		const [headingSlug] = doc.slug.split("/");
		if (!(headingSlug in result))
			result[headingSlug] = {
				title: headingSlug,
				links: [],
			};

		result[headingSlug].links.push({
			title: doc.data.title,
			href: doc.slug,
		});
	}
	return Object.values(result);
}

export async function getStaticPaths() {
	const docs = await getCollection("docs");

	return [...getRoutes(), ...docs.map((doc) => `/docs/${doc.slug}`)].map(
		(slug) => ({
			params: {
				slug,
			},
		}),
	);
}

const navigation = await generateNavigation();
---

<html lang="en" class="h-full w-full">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>specta-rs</title>

    <style>
      body {
        background-color: #0e111a;
        background-image: linear-gradient(
            to bottom,
            transparent 90%,
            rgb(30 41 59) 10%
          ),
          linear-gradient(to right, #0e111a 90%, rgb(30 41 59) 10%);
        background-size:
          5px 5px,
          5px 5px;

        font-family: "Raleway", sans-serif;
        font-optical-sizing: auto;
        font-weight: 600;
        font-style: normal;
        color: red;
      }

      /* Dark mode scroll bars */
      :root {
        color-scheme: dark;
      }
    </style>
  </head>
  <body class="h-full w-full text-white pt-16 overflow-y-hidden">
    <App path={Astro.url.pathname} navigation={navigation} client:idle />
  </body>
</html>
